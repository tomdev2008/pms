M.Page.InntransferPage=M.createClass();M.extend(M.Page.InntransferPage.prototype,{context:{},provincelist:{},citylist:{},regionlist:{},init:function(){this.initDOM();this.initEvent();this.initcitydata();},initDOM:function(){this.context.inntransferform=$("#inntransferform");},initEvent:function(){this.context.inntransferform.bind("click",this.inntransferform_click.toEventHandler(this));this.context.inntransferform.find("select[name=province]").bind('change',this.province_change.toEventHandler(this));this.context.inntransferform.find("select[name=city]").bind('change',this.city_change.toEventHandler(this));},province_change:function(){var pid=this.context.inntransferform.find("select[name=province]").val();var citylist=this.citylist[pid];var html='<option value="">请选择</option>';for(var pid in citylist){var item=citylist[pid];html+='<option value="'+item.id+'">'+item.name+'</option>';}
this.context.inntransferform.find("select[name=city]").html(html);this.context.inntransferform.find("select[name=city]").val('');this.context.inntransferform.find("select[name=region]").html('<option value="">请选择</option>').val('');},city_change:function(){var pid=this.context.inntransferform.find("select[name=city]").val();var regionlist=this.regionlist[pid];var html='<option value="">请选择</option>';for(var pid in regionlist){var item=regionlist[pid];html+='<option value="'+item.id+'">'+item.name+'</option>';}
this.context.inntransferform.find("select[name=region]").html(html);this.context.inntransferform.find("select[name=region]").val('');},inntransferform_click:function(e){var ele=M.EventEle(e);var t=ele.attr('tag');switch(t){case'save':this.save();break;}},save:function(){var data={};data.innname=M.getVal(this.context.inntransferform.find("input[name=innname]"));data.address=M.getVal(this.context.inntransferform.find("input[name=address]"));data.guestname=M.getVal(this.context.inntransferform.find("input[name=guestname]"));data.phone=M.getVal(this.context.inntransferform.find("input[name=phone]"));data.weixin=M.getVal(this.context.inntransferform.find("input[name=weixin]"));data.roomnum=M.getVal(this.context.inntransferform.find("input[name=roomnum]"));data.url=M.getVal(this.context.inntransferform.find("input[name=url]"));data.desc=M.getVal(this.context.inntransferform.find("textarea[name=desc]"));data.regionid=this.context.inntransferform.find("select[name=region]").val();data.regionname=this.context.inntransferform.find("select[name=region]").children('option[value='+data.regionid+']').html();data.pid=this.context.inntransferform.find("select[name=province]").val();data.pname=this.context.inntransferform.find("select[name=province]").children('option[value='+data.pid+']').html();data.cityid=this.context.inntransferform.find("select[name=city]").val();data.cityname=this.context.inntransferform.find("select[name=city]").children('option[value='+data.cityid+']').html();M._getjson('/public/addinntransfer',data,this.save_finished.toEventHandler(this),'',true);},save_finished:function(d){if(d.status=="success"){alert('申请成功，请耐心等待1-2个工作日，我们会尽快审核');var from=d.from;if(from=='mobile'){window.location.href='/h5/public/inntransfer';}else{window.location.reload();}}else{if(!M.isEmpty(d.msg)){alert(d.msg);}}},initcitydata:function(){this.provincelist=district[40];this.citylist=des;this.regionlist=area;var html='<option value="">请选择</option>';for(var pid in this.provincelist){var item=this.provincelist[pid];html+='<option value="'+item.id+'">'+item.name+'</option>';}
this.context.inntransferform.find("select[name=province]").html(html);this.context.inntransferform.find("select[name=city]").html('<option value="">请选择</option>');this.context.inntransferform.find("select[name=region]").html('<option value="">请选择</option>');},});var inntransfer;M.ready(function(){var inntransfer=new M.Page.InntransferPage();return inntransfer;});